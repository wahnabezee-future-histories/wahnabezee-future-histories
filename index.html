<title>bi</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
      body {
	margin: 0;
	background-color: #000;
	color: #fff;
	font-family: Monospace;
	font-size: 13px;
	line-height: 24px;
}

a {
	color: #ff0;
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

button {
	cursor: pointer;
	text-transform: uppercase;
}

canvas {
	display: block;
}

#info {
	position: absolute;
	top: 0px;
	width: 100%;
	padding: 10px;
	box-sizing: border-box;
	text-align: center;
	z-index: -1; /* TODO Solve this in HTML */
}
#info2 {
	position: absolute;
	top: 75%;
	width: 100%;
	padding: 10px;
	box-sizing: border-box;
	text-align: center;
	z-index: -1; /* TODO Solve this in HTML */
}

.dg.ac {
	z-index: -2000 !important; /* TODO Solve this in HTML */
 }

#container {
	position: fixed;
	top: 0px;
	width: 100%;
	padding: 0px;
	box-sizing: border-box;
	text-align: center;
	-moz-user-select: none;
	-webkit-user-select: none;
	-ms-user-select: none;
	/* user-select: none; */
	pointer-events: auto;
	z-index: -99;} 
    </style>
	
	
    

		<div id="info2">
		</div>
    <div id="container">

    <canvas data-engine="three.js r142" width="1520" height="976" tabindex="0" style="display: block; width: 1520px; height: 976px;"></canvas></div>
		<!-- <div class="sidebar">
			<h2></h2>
			<h2></h2>
			<h2></h2>
			<h2></h2>
		</div> -->


    

		<script type="module">

import * as THREE from 'https://unpkg.com/three@0.142.0/build/three.module.js';

// import Stats from 'https://threejsfundamentals.org/threejs/resources/threejs/r122/examples/jsm/libs/stats.module.js';
// import { GUI } from 'https://threejsfundamentals.org/threejs/resources/threejs/r122/examples/jsm/libs/dat.gui.module.js';

import { OrbitControls } from 'https://threejsfundamentals.org/threejs/resources/threejs/r122/examples/jsm/controls/OrbitControls.js'
// import { FontLoader } from 'https://threejsfundamentals.org/threejs/resources/threejs/r122/examples/jsm/loaders/FontLoader.js';


let container, stats, guiStatsEl;
    // let gui
let camera, light, backlight, controls, scene, renderer, material;


const loader = new THREE.TextureLoader();

const aerialgroup = new THREE.Group();
const drawinggroup = new THREE.Group();
const bubblegroup = new THREE.Group();

var time = new THREE.Clock();

const objects=[];
const annotations=[];

bubblegroup.add(objects);



// gui

const Method = {
  INSTANCED: 'INSTANCED',
  MERGED: 'MERGED',
  NAIVE: 'NAIVE'
};

const api = {
  method: Method.INSTANCED,
  count: 1000
};

//raycaster/////////////////////////////////////////////////////////////////////////////////
const raycaster = new THREE.Raycaster();
const pointer = new THREE.Vector2();

// onPointerDown();
// onPointerDown2();

function onPointerDown( event ) {

// calculate pointer position in normalized device coordinates
// (-1 to +1) for both components


    pointer.set( ( event.clientX / window.innerWidth ) * 2 - 1, - ( event.clientY / window.innerHeight ) * 2 + 1 );

	raycaster.setFromCamera( pointer, camera );

				const intersects = raycaster.intersectObjects( objects, false );
                if ( intersects.length > 0 ) {
                    const intersect = intersects[ 0 ];
                    for (let a = 0; a<objects.length; a++){
                        if (objects[a]===intersect.object) {
                            bubblegroup.add(annotations[a])
                        } 
                        else{
                            bubblegroup.remove(annotations[a])
                            
                        }
                    }
    }



};
// window.addEventListener( 'pointerdown', onPointerDown );




////////////////////////////////////////////////////////////////////////////////////////

init();
    // initmediaobj();
// initMesh();
animate();



        const mapgeo = new THREE.PlaneGeometry(30,21);
        const map2material = new THREE.MeshBasicMaterial({map: loader.load("basemap.png"), transparent:true})
        const cloudmaterial = new THREE.MeshBasicMaterial({map: loader.load("cloud.png"), transparent:true});
        const boatmaterial = new THREE.MeshBasicMaterial({map: loader.load("cloud-02.png"), transparent:true});
        const eaglematerial = new THREE.MeshBasicMaterial({map: loader.load("cloud-03.png"), transparent:true});

	mapmaterial.alphaTest = 0.5;
        map2material.alphaTest = 0.5;
	cloudmaterial.alphaTest = 0.5;
			
	const boatgeo = new THREE.PlaneGeometry(15,7);
  const cloudgeo = new THREE.PlaneGeometry(4.8,3.3);
  const eaglegeo = new THREE.PlaneGeometry(3.2,4);
  
	const cloud = new THREE.Mesh(cloudgeo, cloudmaterial);
  const boat = new THREE.Mesh(boatgeo, boatmaterial);
  const eagle = new THREE.Mesh(eaglegeo, eaglematerial);

	
        const map = new THREE.Mesh(mapgeo,mapmaterial);
        // map.rotation.y= 0.5*Math.PI;
        const map2 = new THREE.Mesh(mapgeo,map2material);
        // map.position.=0;
        // map2.position.z=1;
			
	cloud.position.z = 5;
	cloud.position.x = -6.3;
  cloud.position.y = 0;
  boat.position.z = -2;
	boat.position.x = -4;
  boat.position.y = 6;

  eagle.position.z = 5;
	eagle.position.x = 2;
  eagle.position.y = 0;
	
        
        drawinggroup.add(map2, cloud, boat,eagle);
			


const whitebasegeo = new THREE.PlaneGeometry(100,100);
const whitematerial = new THREE.MeshBasicMaterial({color:0xffffff});
const whitebase = new THREE.Mesh(whitebasegeo,whitematerial);
whitebase.position.z=-10;
bubblegroup.add(whitebase);


                            -0.145144231	,
                            -0.190475427	,
                            -0.418819444	,
                            -0.133285256	,
                            -0.423397436	,
                            -0.395470085	,
                            -0.108269231	,
                            -0.160186966	,
                            -0.416490385	,
                            -0.19661859	,
                            -0.241736111	,
                            -0.276244658	,
                            -0.312884615	,
                            -0.328942308	,
                            -0.314738248	,
                            -0.210699786	,
                            0.084439103	,
                            -0.158103632	,
                            0.345491453	,
                            0.083803419	,
                            0.235149573	,
                            -0.124358974	,
                            0.421971154	,
                            ]
const name =["	Buildings1	",
              "	Detroit Police Harbor Master	",
              "	Buildings2	",
              "	Belle Isle Casino	",
              "	Belle Isle Boat House	",
              "	Flynn Pavilion	",
              "	Remick Music Shell	",
              "	Buildings3	",
              "	Kids Row Ice Cream Cafe	",
              "	Dossin Great Lakes Museum	",
              "	Giant Slide	",
              "	Buildings4	",
              "	White House	",
              "	Belle Isle Aquarium	",
              "	conservatory	",
              "	Green House	",
              "	Belle Isle Sawmill	",
              "	Belle Isle Beach House	",
              "	Buildings6	",
              "	Detroit Yacht Club	",
              "	Buildings7	",
              "	Belle Isle Nature Center	",
              "	US Coast Guard Station Belle Isle	",
              "	Buildings8	",
                
              ]
for (let i=0; i<xbuildinggeocoorlist.length; i++){
    let annotationmaterial, annotationgeo, annotationsprite;

    let bubble, bubblegeo, bubblecolor;
    let agroup;
 annotationmaterial = new THREE.MeshBasicMaterial({map: loader.load(annotationlist[i]), transparent:true});
    annotationgeo = new THREE.PlaneGeometry( 2,2 );
    annotationsprite = new THREE.Mesh( annotationgeo, annotationmaterial ) ;
   
    const color = new THREE.Color();
	color.setHSL( Math.random(), 0.7, Math.random() * 0.2 + 0.05, 0.1 );

    bubblegeo = new THREE.PlaneGeometry( 0.4, 0.4  );
    
	bubblecolor = new THREE.MeshBasicMaterial( { map: loader.load("https://freight.cargo.site/t/original/i/ff71fad49153d0756a57af569c041845386c4b34657545d20c3a277869cec8e4/noun-cross-2136719.png"), transparent: true} );

	bubble = new THREE.Mesh( bubblegeo, bubblecolor );
    bubble.position.x=xbuildinggeocoorlist[i]*widthratiomap*unitmap;
    bubble.position.y=ybuildinggeocoorlist[i]*heightratiomap*unitmap;
 annotationsprite.position.copy(bubble.position);
 annotationsprite.position.z = annotationsprite.position.z+0.5;



    // agroup.add(bubble);
    // bubble.add(annotationsprite);

    // bubble.add(annotationsprite)
    // annotationsprite.visible=false;
    // annotationsprite.scale.set( awidth, aheight, 1 );
    objects.push(bubble)
    annotations.push(annotationsprite)
    // bubble.add(annotationsprite)

    bubblegroup.add(bubble);


}


			
var particles = 40777;
        let positions = [];
        var geometry = new THREE.BufferGeometry();
        var n = 50, n2 = n / 2; 
        var materialpoints = new THREE.PointsMaterial( { map: loader.load("water.png"), transparent:true,  size: 0.5, vertexColors: false } );

        for ( var i = 0; i < particles; i ++ ) {
            var x = Math.random() * n - n2;
            var y = Math.random() * n - n2;
            var z = -1;
            positions.push( x, y, z );

        }
        geometry.setAttribute( 'position', new THREE.Float32BufferAttribute( positions, 3 ) );
        geometry.computeBoundingSphere();
        const water = new THREE.Points( geometry, materialpoints );
    
        drawinggroup.add(water);


    scene.add(drawinggroup);
    var params = {
				scene: "bubble"
			};
// const gui = new GUI();

// gui.add(params,'scene',['aerial map', 'drawing', 'bubble']).onChange( function (value){
//   switch(value){
//     case 'aerial map': scene.add(aerialgroup);
//                         scene.remove(drawinggroup);
//                         scene.remove(bubblegroup);

//                         break;
//     case 'drawing': 
//                          scene.remove(aerialgroup);
//                         scene.add(drawinggroup);   
//                         scene.remove(bubblegroup);
//                         break;    
//    case 'bubble': scene.remove(aerialgroup);
//                     scene.remove(drawinggroup);
//                         scene.add(bubblegroup);   
//                         break;           
//   }
// })


function init() {

  const width = window.innerWidth;
  const height = window.innerHeight;

  // camera

//   camera = new THREE.OrthographicCamera( width / - 2, width / 2, height / 2, height / -2, 1, 100 );
camera = new THREE.PerspectiveCamera( 50, width / height, 1, 100 );

  camera.position.z = 20;
//   camera.position.y = 0;

//   camera.position.x = 0;

        //light
        light = new THREE.AmbientLight( 0xffffff, 1 );
  // backlight = new THREE.DirectionalLight( 0xffffff, 1 );

        light.position.set( 0, 0, 10 ).normalize();
        // backlight.position.set( 0, 0, -10 ).normalize();

  // renderer

  renderer = new THREE.WebGLRenderer( { antialias: true } );
  renderer.setPixelRatio( window.devicePixelRatio );
  renderer.setSize( width, height );
  renderer.outputEncoding = THREE.sRGBEncoding;

  container = document.getElementById( 'container' );
  container.appendChild( renderer.domElement );

  // scene

  scene = new THREE.Scene();
  scene.background = new THREE.Color( 0x000000 );

  // controls

  controls = new OrbitControls( camera, renderer.domElement );
	
	controls.mouseButtons = {
	RIGHT: THREE.MOUSE.ROTATE,
	MIDDLE: THREE.MOUSE.DOLLY,
	LEFT: THREE.MOUSE.PAN
}
  controls.enableRotate = false;
  // controls.autoRotate = true;
	controls.maxDistance = 30;

  // stats

//   stats = new Stats();
//   container.appendChild( stats.dom );


        scene.add(light)


  window.addEventListener( 'resize', onWindowResize );

  Object.assign( window, { scene } );

}

//

function onWindowResize() {

  const width = window.innerWidth;
  const height = window.innerHeight;

  camera.aspect = width / height;
  camera.updateProjectionMatrix();

  renderer.setSize( width, height );

}

function animate() {
  requestAnimationFrame( animate );

  controls.update();
//   stats.update();

  render();

}

function render() {

  renderer.render( scene, camera );

}

//

function getGeometryByteLength( geometry ) {

  let total = 0;

  if ( geometry.index ) total += geometry.index.array.byteLength;

  for ( const name in geometry.attributes ) {

    total += geometry.attributes[ name ].array.byteLength;

  }

  return total;

}

// Source: https://stackoverflow.com/a/18650828/1314762
function formatBytes( bytes, decimals ) {

  if ( bytes === 0 ) return '0 bytes';

  const k = 1024;
  const dm = decimals < 0 ? 0 : decimals;
  const sizes = [ 'bytes', 'KB', 'MB' ];

  const i = Math.floor( Math.log( bytes ) / Math.log( k ) );

  return parseFloat( ( bytes / Math.pow( k, i ) ).toFixed( dm ) ) + ' ' + sizes[ i ];

}
		</script>
